# Rekovi - Aplicativo Android Nativo

Aplicativo Android nativo para o sistema Rekovi de gestão de recolha de veículos, construído com Kotlin, Jetpack Compose e arquitetura MVVM.

## 🏗️ Arquitetura

### Tecnologias Utilizadas
- **Kotlin** 2.2.0
- **Jetpack Compose** com Material Design 3
- **Arquitetura MVVM** com Repository Pattern
- **Hilt** para Injeção de Dependência
- **Supabase-KT** para backend e real-time
- **Coroutines & Flow** para programação assíncrona
- **DataStore** para persistência local

### Estrutura do Projeto
```
app/src/main/java/com/rekovi/taskmanager/
├── data/                           # Camada de Dados
│   ├── repository/                 # Repositórios
│   └── source/
│       ├── local/                  # Fontes de dados locais
│       └── remote/                 # Fontes de dados remotas
├── di/                             # Injeção de Dependência
├── domain/                         # Camada de Domínio
│   └── model/                      # Modelos de domínio
├── presentation/                   # Camada de Apresentação
│   ├── auth/                       # Telas de autenticação
│   ├── components/                 # Componentes reutilizáveis
│   ├── navigation/                 # Sistema de navegação
│   ├── tasks/                      # Telas de tarefas
│   └── theme/                      # Tema da aplicação
└── utils/                          # Utilitários
```

## ⚙️ Configuração

### 1. Configurações de Build

O projeto está configurado com as seguintes versões **obrigatórias**:

- **Gradle**: 8.11.1
- **Android Gradle Plugin (AGP)**: 8.10.2
- **Kotlin**: 2.2.0
- **Compile SDK**: 35
- **Target SDK**: 35
- **Min SDK**: 24
- **Java**: 1.8

### 2. Configurar Supabase

Edite o arquivo `app/src/main/java/com/rekovi/taskmanager/data/source/remote/SupabaseClient.kt`:

```kotlin
companionobject {
    const val SUPABASE_URL = "https://SEU_PROJETO.supabase.co"
    const val SUPABASE_ANON_KEY = "SUA_CHAVE_ANONIMA_AQUI"
}
```

### 3. Estrutura do Banco de Dados

O aplicativo requer as seguintes tabelas/views no Supabase:

#### Tabela: `pre_approved_users`
```sql
CREATE TABLE pre_approved_users (
    id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    email text NOT NULL,
    permission_type text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    status text DEFAULT 'active'::text NOT NULL,
    empresa text,
    ultimo_login timestamp with time zone,
    logs jsonb DEFAULT '[]'::jsonb,
    area_atuacao jsonb,
    nome text,
    CONSTRAINT pre_approved_users_pkey PRIMARY KEY (id),
    CONSTRAINT pre_approved_users_email_key UNIQUE (email)
);
```

#### View: `v_pipefy_cards_detalhada`
Esta view deve conter os campos essenciais dos cards/tarefas:
- `card_id`, `placa_veiculo`, `nome_driver`, `nome_chofer_recolha`
- `phase_name`, `created_at`, `email_chofer`, `empresa_recolha`
- `modelo_veiculo`, `telefone_contato`, `telefone_opcional`, `email_cliente`
- `endereco_cadastro`, `endereco_recolha`, `link_mapa`, `origem_locacao`
- `valor_recolha`, `custo_km_adicional`, `public_url`

### 4. Dados de Teste

#### Usuário de Teste
```sql
-- Criar no Supabase Auth
Email: admin@teste.com
Password: 123456

-- Inserir na tabela pre_approved_users
INSERT INTO pre_approved_users (email, permission_type, status, empresa, area_atuacao)
VALUES ('admin@teste.com', 'admin', 'active', 'kovi', '["São Paulo", "Rio de Janeiro"]');
```

## 🚀 Funcionalidades

### ✅ Implementadas

#### Autenticação
- [x] Login com email/senha via Supabase Auth
- [x] Validação de usuários na tabela `pre_approved_users`
- [x] Controle de permissões (admin/kovi, ativa/onsystem, chofer)
- [x] Logout com limpeza de dados locais
- [x] Persistência de sessão com DataStore

#### Lista de Tarefas
- [x] Carregamento inicial das tarefas
- [x] Filtros por fase e busca por texto
- [x] Pull-to-refresh para atualização manual
- [x] Real-time updates via Supabase Realtime
- [x] Interface otimizada para mobile com Material Design 3
- [x] Ordenação por ID (crescente)

#### Detalhes da Tarefa
- [x] Modal completo com todas as informações do card
- [x] Links clicáveis (telefones, emails, mapas)
- [x] Interface responsiva e acessível

#### Sistema de Permissões
- [x] **Admin/Kovi**: Acesso total a todos os cards
- [x] **Ativa/OnSystem**: Acesso apenas aos cards da empresa correspondente
- [x] **Chofer**: Acesso apenas aos cards onde `email_chofer` = email do usuário

### 🔄 Próximas Funcionalidades
- [ ] Notificações push
- [ ] Modo offline com sincronização
- [ ] Autenticação biométrica
- [ ] Temas escuro/claro automático
- [ ] Cache inteligente de dados
- [ ] Métricas e analytics

## 🎨 Design System

### Cores Principais
- **Primary**: `#FF355A` (Vermelho Rekovi)
- **Secondary**: `#E62E4F` (Vermelho escuro)
- **Background**: Gradientes com as cores da marca

### Fases de Cards
- **Fila de Recolha**: Azul
- **Aprovar Custo**: Amarelo
- **Tentativas 1/2**: Laranja
- **Tentativa 3**: Vermelho
- **Desbloquear Veículo**: Roxo
- **Solicitar Guincho**: Índigo
- **Nova Tentativa**: Verde
- **Confirmação de Entrega**: Verde

## 🔧 Desenvolvimento

### Executar o Projeto

1. **Pré-requisitos**
   - Android Studio Hedgehog+ (2023.3.1+)
   - JDK 17 configurado no Gradle
   - Android SDK API 35+

2. **Passos**
   ```bash
   # Clone o repositório
   git clone <repo-url>
   cd rekovi_apk
   
   # Abra no Android Studio
   # Configure as credenciais do Supabase
   # Execute o projeto (Shift+F10)
   ```

### Build para Produção

```bash
# APK de release
./gradlew assembleRelease

# Android App Bundle (Google Play)
./gradlew bundleRelease
```

## 🔒 Segurança

### Implementações de Segurança
- Headers de autenticação automáticos via Supabase
- Validação de permissões em todas as requests
- Tokens armazenados de forma segura com DataStore
- Limpeza automática de dados sensíveis no logout
- Validação de SSL/TLS nas conexões de rede

### Para Produção
- [ ] Habilitar ProGuard/R8 para ofuscação
- [ ] Implementar certificate pinning
- [ ] Usar Android Keystore para tokens sensíveis
- [ ] Remover logs de debug
- [ ] Implementar detecção de root/debug

## 📊 Performance

### Otimizações Implementadas
- LazyColumn para listas grandes de tarefas
- Debounce na busca para evitar requests excessivas
- Cache inteligente com StateFlow
- Pull-to-refresh nativo do Compose
- Real-time updates eficientes via WebSocket

## 🧪 Testes

### Fluxo de Teste Completo
1. Fazer login com `admin@teste.com` / `123456`
2. Verificar carregamento das tarefas
3. Testar filtros por fase
4. Testar busca por texto
5. Testar pull-to-refresh
6. Abrir detalhes de uma tarefa
7. Testar links clicáveis
8. Fazer logout

## 📞 Suporte

Para problemas ou dúvidas:
1. Verificar este README
2. Consultar logs do Android Studio (Logcat)
3. Verificar configurações do Supabase
4. Testar conectividade de internet

---

**Desenvolvido para Rekovi com ❤️ usando Android + Kotlin + Jetpack Compose**