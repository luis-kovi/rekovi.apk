# Rekovi - Aplicativo Android Nativo

Aplicativo Android nativo para o sistema Rekovi de gestÃ£o de recolha de veÃ­culos, construÃ­do com Kotlin, Jetpack Compose e arquitetura MVVM.

## ğŸ—ï¸ Arquitetura

### Tecnologias Utilizadas
- **Kotlin** 2.2.0
- **Jetpack Compose** com Material Design 3
- **Arquitetura MVVM** com Repository Pattern
- **Hilt** para InjeÃ§Ã£o de DependÃªncia
- **Supabase-KT** para backend e real-time
- **Coroutines & Flow** para programaÃ§Ã£o assÃ­ncrona
- **DataStore** para persistÃªncia local

### Estrutura do Projeto
```
app/src/main/java/com/rekovi/taskmanager/
â”œâ”€â”€ data/                           # Camada de Dados
â”‚   â”œâ”€â”€ repository/                 # RepositÃ³rios
â”‚   â””â”€â”€ source/
â”‚       â”œâ”€â”€ local/                  # Fontes de dados locais
â”‚       â””â”€â”€ remote/                 # Fontes de dados remotas
â”œâ”€â”€ di/                             # InjeÃ§Ã£o de DependÃªncia
â”œâ”€â”€ domain/                         # Camada de DomÃ­nio
â”‚   â””â”€â”€ model/                      # Modelos de domÃ­nio
â”œâ”€â”€ presentation/                   # Camada de ApresentaÃ§Ã£o
â”‚   â”œâ”€â”€ auth/                       # Telas de autenticaÃ§Ã£o
â”‚   â”œâ”€â”€ components/                 # Componentes reutilizÃ¡veis
â”‚   â”œâ”€â”€ navigation/                 # Sistema de navegaÃ§Ã£o
â”‚   â”œâ”€â”€ tasks/                      # Telas de tarefas
â”‚   â””â”€â”€ theme/                      # Tema da aplicaÃ§Ã£o
â””â”€â”€ utils/                          # UtilitÃ¡rios
```

## âš™ï¸ ConfiguraÃ§Ã£o

### 1. ConfiguraÃ§Ãµes de Build

O projeto estÃ¡ configurado com as seguintes versÃµes **obrigatÃ³rias**:

- **Gradle**: 8.11.1
- **Android Gradle Plugin (AGP)**: 8.10.2
- **Kotlin**: 2.2.0
- **Compile SDK**: 35
- **Target SDK**: 35
- **Min SDK**: 24
- **Java**: 1.8

### 2. Configurar Supabase

Edite o arquivo `app/src/main/java/com/rekovi/taskmanager/data/source/remote/SupabaseClient.kt`:

```kotlin
companionobject {
    const val SUPABASE_URL = "https://SEU_PROJETO.supabase.co"
    const val SUPABASE_ANON_KEY = "SUA_CHAVE_ANONIMA_AQUI"
}
```

### 3. Estrutura do Banco de Dados

O aplicativo requer as seguintes tabelas/views no Supabase:

#### Tabela: `pre_approved_users`
```sql
CREATE TABLE pre_approved_users (
    id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    email text NOT NULL,
    permission_type text NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    status text DEFAULT 'active'::text NOT NULL,
    empresa text,
    ultimo_login timestamp with time zone,
    logs jsonb DEFAULT '[]'::jsonb,
    area_atuacao jsonb,
    nome text,
    CONSTRAINT pre_approved_users_pkey PRIMARY KEY (id),
    CONSTRAINT pre_approved_users_email_key UNIQUE (email)
);
```

#### View: `v_pipefy_cards_detalhada`
Esta view deve conter os campos essenciais dos cards/tarefas:
- `card_id`, `placa_veiculo`, `nome_driver`, `nome_chofer_recolha`
- `phase_name`, `created_at`, `email_chofer`, `empresa_recolha`
- `modelo_veiculo`, `telefone_contato`, `telefone_opcional`, `email_cliente`
- `endereco_cadastro`, `endereco_recolha`, `link_mapa`, `origem_locacao`
- `valor_recolha`, `custo_km_adicional`, `public_url`

### 4. Dados de Teste

#### UsuÃ¡rio de Teste
```sql
-- Criar no Supabase Auth
Email: admin@teste.com
Password: 123456

-- Inserir na tabela pre_approved_users
INSERT INTO pre_approved_users (email, permission_type, status, empresa, area_atuacao)
VALUES ('admin@teste.com', 'admin', 'active', 'kovi', '["SÃ£o Paulo", "Rio de Janeiro"]');
```

## ğŸš€ Funcionalidades

### âœ… Implementadas

#### AutenticaÃ§Ã£o
- [x] Login com email/senha via Supabase Auth
- [x] ValidaÃ§Ã£o de usuÃ¡rios na tabela `pre_approved_users`
- [x] Controle de permissÃµes (admin/kovi, ativa/onsystem, chofer)
- [x] Logout com limpeza de dados locais
- [x] PersistÃªncia de sessÃ£o com DataStore

#### Lista de Tarefas
- [x] Carregamento inicial das tarefas
- [x] Filtros por fase e busca por texto
- [x] Pull-to-refresh para atualizaÃ§Ã£o manual
- [x] Real-time updates via Supabase Realtime
- [x] Interface otimizada para mobile com Material Design 3
- [x] OrdenaÃ§Ã£o por ID (crescente)

#### Detalhes da Tarefa
- [x] Modal completo com todas as informaÃ§Ãµes do card
- [x] Links clicÃ¡veis (telefones, emails, mapas)
- [x] Interface responsiva e acessÃ­vel

#### Sistema de PermissÃµes
- [x] **Admin/Kovi**: Acesso total a todos os cards
- [x] **Ativa/OnSystem**: Acesso apenas aos cards da empresa correspondente
- [x] **Chofer**: Acesso apenas aos cards onde `email_chofer` = email do usuÃ¡rio

### ğŸ”„ PrÃ³ximas Funcionalidades
- [ ] NotificaÃ§Ãµes push
- [ ] Modo offline com sincronizaÃ§Ã£o
- [ ] AutenticaÃ§Ã£o biomÃ©trica
- [ ] Temas escuro/claro automÃ¡tico
- [ ] Cache inteligente de dados
- [ ] MÃ©tricas e analytics

## ğŸ¨ Design System

### Cores Principais
- **Primary**: `#FF355A` (Vermelho Rekovi)
- **Secondary**: `#E62E4F` (Vermelho escuro)
- **Background**: Gradientes com as cores da marca

### Fases de Cards
- **Fila de Recolha**: Azul
- **Aprovar Custo**: Amarelo
- **Tentativas 1/2**: Laranja
- **Tentativa 3**: Vermelho
- **Desbloquear VeÃ­culo**: Roxo
- **Solicitar Guincho**: Ãndigo
- **Nova Tentativa**: Verde
- **ConfirmaÃ§Ã£o de Entrega**: Verde

## ğŸ”§ Desenvolvimento

### Executar o Projeto

1. **PrÃ©-requisitos**
   - Android Studio Hedgehog+ (2023.3.1+)
   - JDK 17 configurado no Gradle
   - Android SDK API 35+

2. **Passos**
   ```bash
   # Clone o repositÃ³rio
   git clone <repo-url>
   cd rekovi_apk
   
   # Abra no Android Studio
   # Configure as credenciais do Supabase
   # Execute o projeto (Shift+F10)
   ```

### Build para ProduÃ§Ã£o

```bash
# APK de release
./gradlew assembleRelease

# Android App Bundle (Google Play)
./gradlew bundleRelease
```

## ğŸ”’ SeguranÃ§a

### ImplementaÃ§Ãµes de SeguranÃ§a
- Headers de autenticaÃ§Ã£o automÃ¡ticos via Supabase
- ValidaÃ§Ã£o de permissÃµes em todas as requests
- Tokens armazenados de forma segura com DataStore
- Limpeza automÃ¡tica de dados sensÃ­veis no logout
- ValidaÃ§Ã£o de SSL/TLS nas conexÃµes de rede

### Para ProduÃ§Ã£o
- [ ] Habilitar ProGuard/R8 para ofuscaÃ§Ã£o
- [ ] Implementar certificate pinning
- [ ] Usar Android Keystore para tokens sensÃ­veis
- [ ] Remover logs de debug
- [ ] Implementar detecÃ§Ã£o de root/debug

## ğŸ“Š Performance

### OtimizaÃ§Ãµes Implementadas
- LazyColumn para listas grandes de tarefas
- Debounce na busca para evitar requests excessivas
- Cache inteligente com StateFlow
- Pull-to-refresh nativo do Compose
- Real-time updates eficientes via WebSocket

## ğŸ§ª Testes

### Fluxo de Teste Completo
1. Fazer login com `admin@teste.com` / `123456`
2. Verificar carregamento das tarefas
3. Testar filtros por fase
4. Testar busca por texto
5. Testar pull-to-refresh
6. Abrir detalhes de uma tarefa
7. Testar links clicÃ¡veis
8. Fazer logout

## ğŸ“ Suporte

Para problemas ou dÃºvidas:
1. Verificar este README
2. Consultar logs do Android Studio (Logcat)
3. Verificar configuraÃ§Ãµes do Supabase
4. Testar conectividade de internet

---

**Desenvolvido para Rekovi com â¤ï¸ usando Android + Kotlin + Jetpack Compose**